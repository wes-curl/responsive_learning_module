<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <script src="https://cdn.jsdelivr.net/npm/underscore@1.13.1/underscore-umd-min.js"></script>
        <script src="scripts.js"></script>
        
    </head>
    

    <script>

        //adds a row to the table of ID = responce_table
        function addRow(){
            const table = document.getElementById("responce_table");

            //if there is no hidden element to unhide
            if(getHiddenRow() == null){
                const row = document.getElementById("template");
                let new_row = row.cloneNode(true);
                new_row.removeAttribute("hidden");
                new_row.id = "";
                table.children[1].appendChild(new_row);
            } else {
                unhideRow();
            }
        }

        //hides the bottom visible row of the table
        function removeRow(){
            const table = document.getElementById("responce_table");
            var children = table.children[1].children;
            console.log(children);
            for (var i = children.length - 1; i >= 0 ; i--) {
                var tableChild = children[i];
                // Do stuff
                if(tableChild.getAttribute("hidden") == null){
                    tableChild.setAttribute("hidden", 1);
                    return 0;
                }
            }   
        }

        //returns a tr element if there is a hidden row. This element is the FIRST hidden row. 
        //Otherwise, it returns NULL
        function getHiddenRow(){
            const table = document.getElementById("responce_table");
            var children = table.children[1].children;
            for (var i = 0; i < children.length; i++) {
                var tableChild = children[i];
                // Do stuff
                if(tableChild.getAttribute("hidden") != null && tableChild.id != "template"){
                    return tableChild;
                }
            }   
            return null;
        }

        //returns the last unhidden row
        function getRow(){
            const table = document.getElementById("responce_table").childNodes[3];
            var children = table.children;
            var last = null;
            for (var i = 0; i < children.length; i++) {
                var tableChild = children[i];
                // Do stuff
                if(tableChild.getAttribute("hidden") == null && tableChild.tagName === "TR"){
                    last = tableChild;
                }
            }   
            
            return last;
        }

        //unhides the first hidden row
        function unhideRow(){
            const row = getHiddenRow();
            row.removeAttribute("hidden");
        }

        function updateValue(button, text){
            button.parentElement.parentElement.children[2].textContent = solve(text);
            button.parentElement.parentElement.children[3].textContent = solveUnits(text).toString();
        }

        //updates all the user-defined variables
        function updateVariables(){
            var namers = document.getElementsByClassName("variable_name");
            var vars = [...baseVariables];
            for(var i = 0; i < namers.length; i++){
                var namer = namers[i];
                var text = namer.parentElement.parentElement.children[1].children[0].value;
                var value = namer.parentElement.parentElement.children[2].textContent;
                debugger;
                var units = solveUnits(namer.parentElement.parentElement.children[0].children[0].value);
                //debugger;
                if(text.length > 0 && notIn(text, vars)){
                    value = parseFloat(value);
                    vars.push(new variable(namer.value, value, units));
                }
            }
            console.log(vars);
            variables = vars;
        }

        function notIn(name, variables){
            for(var i = 0; i < variables.length; i++){
                if(variables[i].name === name){
                    return false;
                }
            }
            return true;
        }

        var baseVariables = [...standardConversions,
            new variable("v",60, new unit(["miles"],["hours"])),
            new variable("d",60, new unit(["feet"],[]))
            ];

        var variables = [...standardConversions,
            new variable("v",60, new unit(["miles"],["hours"])),
            new variable("d",60, new unit(["feet"],[]))
            ];
    </script>

    

    <body>
        <p class="title">
            This is a Mockup of a Potential Page
        </p>

        <p>
            This project is an attempt to invent a new way to teach physics. The system works by first presenting useful information
            in education pages, then to test it in review pages (like this one). The review pages present context (this part) and a 
            problem (below) then the user has to answer it. This is done through the fillable section at the end.
        </p>

        <p class="question">
            Alice throws a baseball forward at 60 MPH. Bob is waiting at the plate, 60 feet away. How long does it take for the ball 
            to reach Bob?
        </p>

        <!--These are the things that the user can reference-->
        <ul class="variable_list">
            <li>v = 60 mph</li>
            <li>d = 60 ft</li>
        </ul>

        <!--These are the actual lines to do work!-->
        <table id="responce_table"> 
            <thead>
                <tr>
                    <!--The user types in an equation-->
                    <th>Relationship</th>
                    <!--the output is stroed in this variable-->
                    <th>Value Name</th>
                    <!--This is the value of that variable-->
                    <th>Value</th>  
                    <!--This is the units of that variable-->
                    <th>Units</th>
                    <!--Select a rule that makes this make sense-->
                    <th>Why?</th>
                    <!--Use YOUR words-->
                    <th>Explain.</th>
                </tr>
            </thead>
                <tbody>
                <tr id="template" hidden="true">
                    <td>
                        <textarea class="relationship" onkeyup="updateVariables();updateValue(this, this.value);"></textarea>
                    </td>
                    <td>
                        <textarea class="variable_name" onkeyup="updateVariables()"></textarea>
                    </td>
                    <td class="output">
                        ...
                    </td>
                    <td class="output_units"">
                        ...
                    </td>
                    <td>
                        <select class="explaination">
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                        </select>
                    </td>
                    <td>
                        <textarea class="written_explaination"></textarea>
                    </td>
                </tr>
                <tr id="first_row">
                    <td>
                        <textarea class="relationship" onkeyup="updateVariables();updateValue(this, this.value);"></textarea>
                    </td>
                    <td>
                        <textarea class="variable_name" onkeyup="updateVariables()"></textarea>
                    </td>
                    <td class="output">
                        ...
                    </td>
                    <td class="output_units"">
                        ...
                    </td>
                    <td>
                        <select class="explaination">
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                        </select>
                    </td>
                    <td>
                        <textarea class="written_explaination"></textarea>
                    </td>
                </tr>
            </tbody>
        </table>

        <button class="add_row" id="add_row" onclick="addRow()">+</button>
        <button class="remove_row" id="remove_row" onclick="
            removeRow(); 
            if(getRow().id === 'first_row'){ 
                this.setAttribute('disabled', 'true');
            }else{
                this.removeAttribute('disabled');
            }"
        >-</button>
    </body>
</html>